@using DexResearchArbitrage.Models

<MudPaper Class="pa-4 mb-4">
    <MudText Typo="Typo.h6" Class="mb-3">Filters</MudText>
    
    <MudGrid>
        <!-- Second Token Filter -->
        <MudItem xs="12" md="6" lg="3">
            <MudSelect T="string" 
                       Label="Second Token" 
                       MultiSelection="true"
                       @bind-SelectedValues="SelectedSecondTokens"
                       Placeholder="All tokens"
                       Clearable="true"
                       Dense="true">
                @foreach (var token in AvailableSecondTokens)
                {
                    <MudSelectItem Value="@token">@token</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        
        <!-- TVL Filter -->
        <MudItem xs="12" md="6" lg="2">
            <MudNumericField T="decimal" 
                             Label="Min TVL (USD)" 
                             @bind-Value="Filters.MinTvlUsd"
                             Min="0"
                             Format="N2"
                             Clearable="true"
                             Dense="true" />
        </MudItem>
        
        <!-- Swaps Date Filter -->
        <MudItem xs="12" md="6" lg="2">
            <MudDatePicker Label="Swaps From Date" 
                           @bind-Date="Filters.SwapsFromDate"
                           Clearable="true"
                           MaxDate="DateTime.Today"
                           Dense="true" />
        </MudItem>
        
        <!-- Min Swaps Count Filter -->
        <MudItem xs="12" md="6" lg="2">
            <MudNumericField T="int" 
                             Label="Min Swaps" 
                             @bind-Value="Filters.MinSwapCount"
                             Min="0"
                             Clearable="true"
                             Dense="true" />
        </MudItem>
        
        <!-- Price Diff Filter -->
        <MudItem xs="12" md="6" lg="2">
            <MudNumericField T="decimal" 
                             Label="Min Price Diff %" 
                             @bind-Value="Filters.MinPriceDiffPercent"
                             Min="0"
                             Max="100"
                             Format="N2"
                             Clearable="true"
                             Dense="true" />
        </MudItem>
        
        <!-- Action Buttons -->
        <MudItem xs="12" md="6" lg="1" Class="d-flex align-center gap-2">
            <MudButton Variant="Variant.Filled" 
                       Color="Color.Primary" 
                       Size="Size.Small"
                       OnClick="ApplyFilters">
                Apply
            </MudButton>
            <MudButton Variant="Variant.Outlined" 
                       Color="Color.Secondary" 
                       Size="Size.Small"
                       OnClick="ResetFilters">
                Reset
            </MudButton>
        </MudItem>
    </MudGrid>
</MudPaper>

@code {
    [Parameter]
    public PoolFiltersModel Filters { get; set; } = new();
    
    [Parameter]
    public List<string> AvailableSecondTokens { get; set; } = new();
    
    [Parameter]
    public EventCallback OnFiltersChanged { get; set; }
    
    private IEnumerable<string> SelectedSecondTokens
    {
        get => Filters.SecondTokenAddresses;
        set => Filters.SecondTokenAddresses = value.ToList();
    }
    
    private async Task ApplyFilters()
    {
        await OnFiltersChanged.InvokeAsync();
    }
    
    private async Task ResetFilters()
    {
        Filters.Reset();
        await OnFiltersChanged.InvokeAsync();
    }
}
